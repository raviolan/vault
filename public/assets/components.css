/* --- Open5e Spell Details Modal (ID-scoped) --- */
#open5eSpellDetailsModal {
    position: fixed;
    inset: 0;
    z-index: 50000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(6px);
    /* Prevent scroll on body when open, handled by JS if needed */
}

#open5eSpellDetailsModal[style*="display: none"] {
    /* Hide overlay when not shown */
    display: none !important;
}

#open5eSpellDetailsModal .modal-inner {
    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 18px;
    box-shadow: 0 20px 80px rgba(0,0,0,0.25);
    width: min(900px, calc(100vw - 48px));
    max-height: calc(100vh - 48px);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#open5eSpellDetailsModal .modal-header {
    padding: 18px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    border-bottom: 1px solid var(--border);
    background: none;
}

#open5eSpellDetailsModal .modal-header h2 {
    margin: 0;
    font-size: 1.25em;
    font-weight: 600;
    color: var(--text);
}

#open5eSpellDetailsModal .modal-header button,
#open5eSpellDetailsModal .modal-header [data-close] {
    border: 1px solid var(--border);
    background: var(--panel);
    color: var(--text);
    border-radius: 8px;
    padding: 6px 16px;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.15s;
}
#open5eSpellDetailsModal .modal-header button:hover,
#open5eSpellDetailsModal .modal-header [data-close]:hover {
    background: var(--ui-control-bg-hover, #f0f0f0);
}

#open5eSpellDetailsModal .modal-body {
    flex: 1 1 auto;
    padding: 18px 20px 22px;
    overflow: auto;
    line-height: 1.5;
    background: none;
    color: var(--text);
}

#open5eSpellDetailsModal .o5e-spell-details-meta {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 6px 16px;
    margin: 12px 0 16px;
}
#open5eSpellDetailsModal .o5e-spell-details-meta dt {
    opacity: 0.75;
    font-weight: 500;
    margin: 0;
}
#open5eSpellDetailsModal .o5e-spell-details-meta dd {
    margin: 0;
}
/* Open5e Spell Details Modal */
.o5e-spell-details-meta {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 6px 12px;
    margin-bottom: 8px;
}
.o5e-spell-details-meta dt {
    opacity: .8;
    font-weight: 500;
    margin: 0;
}
.o5e-spell-details-meta dd {
    margin: 0 0 0 4px;
    color: var(--text);
}
.o5e-spell-details-body {
    line-height: 1.45;
    color: var(--text);
    background: none;
    word-break: break-word;
}
/*
 * DM Vault - Components Stylesheet
 *
 * Scope: Reusable UI components (inputs, tags, cards, tooltips, modals, weather).
 * Conventions: Do not change selector specificity or order; tokens used for repeat values.
 *
 * Table of Contents
 * - WYSIWYG Editor
 * - Search/Input
 * - Navigation/Trees
 * - Typography/Meta
 * - Tags/Labels
 * - Graph Panel
 * - Tooltips/Modals
 * - Toolbar/Chips/Tabs
 * - Hovercard
 * - Grid/Cards
 * - Weather
 * - Lightbox
 * - To-Do (delegated to enhanced-todo.css)
 */

/* WYSIWYG Editor Styles */
.inplace-wysiwyg-editor {
    min-height: 350px;
    border: 1px solid #ccc;
    background: #fff;
    padding: 1em;
    font-size: 1.1em;
    outline: none;
    border-radius: var(--radius-2);
    margin-bottom: 0.5em;
}

.wysiwyg-toolbar {
    display: flex;
    gap: 0.5em;
    margin-bottom: 0.5em;
}

.wysiwyg-btn {
    background: #f5f5f5;
    border: 1px solid #bbb;
    border-radius: var(--radius-1);
    padding: 0.2em 0.7em;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.2s;
}

.wysiwyg-btn:hover {
    background: #e0e0e0;
}

/* UI FOUNDATION: controls + buttons + focus
 * Source of truth for base form controls and buttons
 * - Low-specificity via :where(...) to avoid selector wars
 * - Derives from existing theme tokens (see style.css/theme.css)
 *
 * Audit summary (new owners & deconflicts):
 * - Primitives owner: public/assets/components.css (inputs, selects, textareas, buttons, chips)
 * - Duplicates removed/narrowed:
 *   - Global .chip/.search/.nav-item/.tool-tab overrides pruned from style.css
 *   - Modal form field look delegated to foundation (modal.css keeps layout only)
 * - Hardcoded colors: replaced with theme vars or derived tokens below
 * - Themes preserved: color-scheme set to match light/dark themes; no DOM or API changes
 */

/* Control tokens (derived, minimal) */
:root {
    /* UI Foundation tokens (Apple-ish, calm) */
    --ui-radius: var(--radius-6, 12px);
    --ui-hairline: color-mix(in srgb, var(--border) 55%, transparent);
    --ui-control-bg: var(--surface, var(--panel));
    --ui-control-bg-hover: color-mix(in srgb, var(--surface-2, var(--ui-control-bg)) 12%, var(--ui-control-bg));
    --ui-control-bg-active: color-mix(in srgb, var(--surface-2, var(--ui-control-bg)) 18%, var(--ui-control-bg));
    --ui-control-border: var(--ui-hairline);
    --ui-focus: color-mix(in srgb, var(--accent) 22%, transparent);
    --ui-shadow-1: var(--shadow-2, 0 2px 6px rgba(0, 0, 0, 0.16));
    --ui-row-hover: color-mix(in srgb, var(--accent) 6%, transparent);

    /* Back-compat mappings for existing rules in this file */
    --control-bg: var(--ui-control-bg);
    --control-bg-2: var(--surface-2, color-mix(in srgb, var(--ui-control-bg) 92%, var(--text) 8%));
    --control-bg-hover: var(--ui-control-bg-hover);
    --control-bg-active: var(--ui-control-bg-active);
    --control-border: var(--ui-control-border);
    --control-text: var(--text);
    --control-muted: var(--muted);
    --control-radius: var(--ui-radius);
    --control-pad-y: var(--space-3, 8px);
    --control-pad-x: var(--space-4, 10px);
    --focus-border: color-mix(in srgb, var(--accent) 60%, var(--border));
    --focus-ring: 0 0 0 3px var(--ui-focus);
    --focus-ring-outer: 0 0 0 5px color-mix(in srgb, var(--accent) 12%, transparent);

    /* Interactive/link tokens (derived from theme) */
    --link: color-mix(in srgb, var(--accent) 85%, var(--text) 15%);
    --link-hover: color-mix(in srgb, var(--accent) 92%, var(--text) 8%);
    --link-underline: color-mix(in srgb, var(--accent) 35%, transparent);

    /* Button foreground tokens */
    --btn-fg: var(--text);
    --btn-fg-muted: var(--muted);
    --btn-primary-fg: var(--on-primary, color-mix(in srgb, var(--text) 92%, var(--accent) 8%));
}

/* Light theme button and placeholder contrast fixes (token-based, no theme edits) */
body[data-theme='light'],
body[data-theme='auburn-linen'],
body[data-theme='orchid-porcelain'] {

    /* Force default button text to use --text for better contrast */
    :where(button):not(.btn-primary) {
        color: var(--text) !important;
    }

    /* Improve placeholder color and opacity for inputs/textareas */
    :where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check))::placeholder,
    :where(textarea)::placeholder {
        color: color-mix(in srgb, var(--text) 85%, var(--muted) 15%) !important;
        opacity: 1 !important;
    }

    /* Ensure input text uses full contrast in light themes */
    :where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check)),
    :where(textarea) {
        color: var(--text) !important;
    }

    /* Make Notepad placeholder more legible in light themes */
    .right-drawer-content [data-panel='notepad'] #notepad::placeholder {
        color: color-mix(in srgb, var(--text) 78%, var(--muted) 22%) !important;
    }

    /* Ensure Notepad text itself is high-contrast in light themes */
    .right-drawer-content [data-panel='notepad'] #notepad {
        color: #0b0d12 !important;
    }

    /* Strengthen Settings labels and inputs in light themes */
    #settingsPanel .meta,
    #settingsRouteRoot .meta {
        color: color-mix(in srgb, var(--text) 78%, var(--muted) 22%) !important;
    }
    #settingsPanel input,
    #settingsRouteRoot input {
        color: var(--text) !important;
    }

    /* Strengthen select/dropdown readability in light themes */
    :where(select) {
        color: var(--text) !important;
        background: var(--control-bg) !important;
        border-color: var(--control-border) !important;
    }
    :where(select) option {
        color: var(--text) !important;
        background: var(--control-bg) !important;
    }
    :where(select) option[disabled] {
        color: color-mix(in srgb, var(--text) 85%, var(--muted) 15%) !important;
    }
}

/* Global anchors (low specificity, theme-driven) */
:where(a) {
    color: var(--link);
    text-decoration-color: var(--link-underline);
    text-underline-offset: 2px;
    text-decoration-thickness: from-font;
}

:where(a:hover) {
    color: var(--link-hover);
}

:where(a:visited) {
    color: var(--link);
}

:where(a:focus-visible) {
    outline: none;
    box-shadow: var(--focus-ring);
    border-radius: 4px;
}

/* Base controls: inputs, selects, textareas */
:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check)),
:where(textarea),
:where(select) {
    background: var(--control-bg);
    color: var(--control-text);
    border: 1px solid var(--control-border);
    border-radius: var(--control-radius);
    padding: var(--control-pad-y) var(--control-pad-x);
    caret-color: var(--accent);
    transition: background-color .15s ease, color .15s ease, box-shadow .15s ease, border-color .15s ease;
}

:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check))::placeholder,
:where(textarea)::placeholder {
    color: var(--control-muted);
}

:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check):hover),
:where(textarea:hover),
:where(select:hover) {
    background: var(--control-bg-hover);
}

:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check):active),
:where(textarea:active),
:where(select:active) {
    background: var(--control-bg-active);
}

/* Modern focus ring: keyboard only */
:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check)),
:where(textarea),
:where(select) {
    outline: none;
}

:where(input:not([type="checkbox"]):not([type="radio"]):not(.todo-check)):focus-visible,
:where(textarea:focus-visible),
:where(select:focus-visible) {
    border-color: var(--focus-border);
    box-shadow: var(--focus-ring), var(--focus-ring-outer);
}

/* Ensure native dropdowns follow theme */
:where(select) {
    background-color: var(--control-bg);
    color: var(--control-text);
    border-color: var(--control-border);
}

/* Base buttons (keep minimal to avoid stomping specialized icon buttons) */
:where(button):not(.theme-swatch):not(.wysiwyg-btn):not(.modal-close):not(.todo-disclose):not(.todo-chevron):not(.fav-remove) {
    background: var(--control-bg-2, var(--ui-control-bg));
    color: var(--btn-fg);
    border: 1px solid var(--control-border);
    border-radius: var(--control-radius);
    padding: var(--control-pad-y) var(--control-pad-x);
    cursor: pointer;
    transition: background-color .15s ease, color .15s ease, box-shadow .15s ease, border-color .15s ease, transform .05s ease;
}

:where(button):not(.theme-swatch):not(.wysiwyg-btn):not(.modal-close):not(.todo-disclose):not(.todo-chevron):not(.fav-remove):hover {
    background: var(--control-bg-hover);
}

:where(button):not(.theme-swatch):not(.wysiwyg-btn):not(.modal-close):not(.todo-disclose):not(.todo-chevron):not(.fav-remove):active {
    background: var(--control-bg-active);
}

:where(button):focus {
    outline: none;
}

:where(button):focus-visible {
    border-color: var(--focus-border);
    box-shadow: var(--focus-ring), var(--focus-ring-outer);
}

/* Button variants: align all usages (including modal actions) */
:where(.btn-primary) {
    background: var(--primary, var(--accent));
    color: var(--btn-primary-fg);
    border: 1px solid color-mix(in srgb, var(--primary, var(--accent)) 70%, var(--border));
}

:where(.btn-primary:hover) {
    background: var(--primary-hover, color-mix(in srgb, var(--primary, var(--accent)) 92%, var(--text) 8%));
}

:where(.btn-primary:disabled) {
    opacity: .6;
    cursor: not-allowed;
}

:where(.btn-secondary) {
    background: var(--surface-2, var(--control-bg));
    color: var(--btn-fg);
    border: 1px solid var(--control-border);
}

:where(.btn-secondary:hover) {
    background: var(--control-bg-hover);
}

/* OS color-scheme alignment for native controls */
body {
    color-scheme: dark;
}

body[data-theme='light'],
body[data-theme='auburn-linen'],
body[data-theme='orchid-porcelain'] {
    color-scheme: light;
}

body[data-theme='chinese-pearls'],
body[data-theme='mother-of-dragons'],
body[data-theme='desert'] {
    color-scheme: dark;
}

/* Native checkbox/radio tinting */
input[type="checkbox"],
input[type="radio"] {
    accent-color: var(--accent);
}

/* Chips / pills: single source of truth */
/* UI Components and Controls */

/* Search & Input */
.search {
    flex: 1
}

.search input {
    width: 100%;
    padding: var(--space-4) var(--space-5);
    border-radius: var(--radius-3);
    border: 1px solid var(--border);
    background: var(--panel);
    color: var(--text)
}

/* Precise override to guarantee top search readability */
#searchBox {
    color: var(--text, #e5e7eb) !important;
    background: var(--panel, #151821) !important;
    caret-color: var(--text, #e5e7eb);
}
#searchBox::placeholder {
    color: var(--muted, #9aa3b2);
    opacity: 1;
}
#searchBox:-webkit-autofill {
    -webkit-text-fill-color: var(--text, #e5e7eb) !important;
    transition: background-color 99999s ease-out 0s; /* prevent autofill bg flash */
}

/* Navigation & Trees */
.tree ul {
    list-style: none;
    padding-left: 14px;
    margin: 0
}

.tree li {
    margin: 2px 0
}

/* Typography & Meta */
.meta {
    font-size: var(--text-md);
    color: var(--muted)
}

code,
pre {
    background: var(--surface);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: var(--radius-3);
}

pre {
    padding: var(--space-6);
    overflow: auto
}

code {
    padding: var(--space-1) var(--space-2)
}

/* Base type scale for components (light touch; defer page overrides) */
h1,
h2,
h3,
h4 {
    margin-top: 1.2em
}

/* Tags & Labels */
.tag {
    display: inline-block;
    margin-right: 6px;
    padding: 2px 6px;
    border-radius: var(--radius-6);
    background: #1a1f2b;
    color: #a3b6ff;
    border: 1px solid var(--border);
    font-size: var(--text-md)
}

/* Backlinks */
.backlinks a {
    display: block
}

/* Graph Panel */
.graph-panel {
    height: 780px;
    border: 1px solid var(--border);
    border-radius: var(--radius-3);
    margin: var(--space-4) 0;
    background: #0b0d12
}

.main-breadcrumb {
    margin: 0 0 8px 0
}

.graph-side {
    display: flex;
    flex-direction: column;
    height: 100%
}

#graphPreview {
    flex: 1;
    overflow: auto;
    margin-bottom: 8px
}

#graphRecent {
    flex: 1;
    overflow: auto
}

.recent-item a {
    display: block;
    padding: 4px 0
}

/* Tooltips & Modals */
.tooltip {
    position: fixed;
    pointer-events: none;
    z-index: 3000;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    max-width: 320px;
    padding: 6px 8px;
    display: none;
    color: var(--text)
}

/* Toolbar & Chips */
.toolbar {
    display: flex;
    gap: var(--space-4)
}

.chip {
    padding: 4px 8px;
    border: 1px solid var(--ui-hairline);
    border-radius: var(--radius-6);
    background: var(--ui-control-bg);
    color: var(--muted);
    cursor: pointer
}

.chip.active {
    background: var(--accent);
    color: white;
    border-color: transparent
}

/* Tool Tabs */
.tool-tabs {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-4)
}

.tool-tab {
    border: 1px solid var(--ui-hairline);
    background: var(--ui-control-bg);
    color: var(--muted);
    border-radius: 8px;
    padding: 4px 8px;
    cursor: pointer
}

.tool-tab.active {
    background: var(--accent);
    color: #fff;
    border-color: transparent
}

.tool-view {
    display: none
}

.tool-view.active {
    display: block
}

.tool-pin {
    border: 1px solid var(--border);
    background: #10131a;
    color: var(--muted);
    border-radius: var(--radius-3);
    padding: var(--space-2) var(--space-4);
    cursor: pointer
}

.tool-pin.active {
    background: var(--accent);
    color: #fff;
    border-color: transparent
}

/* Hovercard */
.hovercard {
    position: fixed;
    pointer-events: none;
    z-index: 1000;
    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: var(--radius-3);
    max-width: 340px;
    padding: var(--space-4);
    display: none
}

/* Ensure Open5e hovercard floats above all UI */
.o5e-hovercard {
    z-index: 99999;
}

/* Open5e spell inline label */
.o5e-spell {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 999px;
    background: color-mix(in srgb, var(--accent) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--accent) 40%, var(--border));
    color: var(--text);
    font-size: 0.95em;
    line-height: 1.2;
    text-decoration: none;
    cursor: help;
}
.o5e-spell:hover {
    background: color-mix(in srgb, var(--accent) 14%, transparent);
}
.o5e-hovercard.hovercard {
    /* Minor override hook if needed */
}

/* Grid & Cards */

/* Header Media Controls */
/* Footer row layout remains for profile tools; cover tools overlay inside the cover */
.headerMedia .headerMediaFooter {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-top: 10px;
    min-height: 64px;
}

.headerMedia.hasProfile .headerMediaFooter { padding-left: calc(var(--avatar-size-clamped, 140px) + 30px); }

.headerMediaFooterLeft,
.headerMediaFooterRight {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.headerMediaFooterRight { justify-content: flex-end; flex: 1; }

/* Cover controls overlay in the cover (top-right) */
.headerMedia .cover .headerMediaControls {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    gap: 8px;
    padding: 6px;
    border-radius: 10px;
    background: color-mix(in oklab, white 8%, transparent);
    border: 1px solid color-mix(in oklab, black 12%, transparent);
    backdrop-filter: blur(8px);
}

/* Edit-mode dock row above the header image */
.headerMediaDock {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    margin-bottom: 10px;
    /* keep accessible while scrolling through a tall header */
    position: sticky;
    top: 10px;
    z-index: 6;
}

.headerMediaDockRight {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Override old absolute positioning when docked */
.headerMediaDock .headerMediaControls {
    position: static !important;
    top: auto;
    right: auto;
}

/* Save/Cancel bar should also be docked (not absolute) */
.headerMediaDock .headerMediaRepositionBar {
    position: static !important;
    top: auto;
    right: auto;
}

/* Profile controls remain in the footer (left) */
.headerMedia .headerMediaProfileControls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

/* Make chips readable on page background; keep overlay chips dark */
.headerMedia .headerMediaControls .chip,
.headerMedia .headerMediaProfileControls .chip {
    background: rgba(0,0,0,0.12);
    color: inherit;
    border-color: var(--border);
    white-space: nowrap;
}
.headerMedia .headerMediaControls .chip:hover,
.headerMedia .headerMediaProfileControls .chip:hover {
    background: rgba(0,0,0,0.18);
}

/* Overlay bar used during reposition over the image */
.headerMedia .headerMediaRepositionBar {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    gap: 8px;
    padding: 8px;
    border-radius: 12px;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(6px);
}
.headerMedia .headerMediaRepositionBar .chip {
    background: rgba(0,0,0,0.60);
    color: #fff;
    border-color: rgba(255,255,255,0.22);
}
.headerMedia .headerMediaRepositionBar .chip:hover { background: rgba(0,0,0,0.72); }
.page-identity {
    display: flex;
    align-items: flex-end;
    gap: 16px;
    padding: 10px 0 12px 0;
}
.page-identity .avatar-col {
    flex: 0 0 var(--avatar-slot, 0px);
}
.page-identity .name-col {
    flex: 1 1 auto;
    min-width: 0;
}
.page-identity .name-col #pageTitleView,
.page-identity .name-col #pageTitleInput {
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.page-identity .name-col #pageTags {
    margin-top: 4px;
}
.page-identity .actions-col {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    gap: 8px;
}
@media (max-width: 640px) {
    .page-identity { flex-wrap: wrap; }
    .page-identity .actions-col { margin-left: auto; width: 100%; justify-content: flex-end; }
}
.session-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-4)
}

.card {
    border: 1px solid var(--border);
    background: var(--panel);
    padding: var(--space-5);
    border-radius: var(--radius-4)
}

/* Weather card: more app-like layout */
.weather-card {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    /* reduced gap to condense vertical spacing */
    margin-top: var(--space-5);
    padding: var(--space-4);
    /* reduced padding to make card more compact */
}

.weather-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.weather-title {
    font-weight: 700;
    font-size: var(--text-lg)
}

.weather-now {
    /* Center the main block and make it more prominent */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
    /* slightly tighter gap */
    padding: var(--space-3) var(--space-5);
    /* make main block more condensed */
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
    border-radius: var(--radius-4);
    text-align: center;
    width: 100%;
}

.weather-icon {
    font-size: 56px;
    width: 96px;
    height: 96px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-6);
    background: rgba(255, 255, 255, 0.03);
    margin: 0 auto;
}

.weather-icon svg {
    width: 88px;
    height: 88px
}

.weather-main {
    display: flex;
    flex-direction: column;
    gap: 4px;
    /* tighten spacing between condition and meta/temp */
    align-items: center;
}

.weather-condition {
    font-weight: 800;
    font-size: 18px
}

.weather-meta {
    color: rgba(255, 255, 255, 0.9);
    font-size: var(--text-xs)
}

.weather-temp {
    font-weight: 800;
    font-size: 28px;
    color: inherit
}

/* Ensure inner weather card elements inherit the card's computed color
   so text and SVG icons remain readable against varied gradients. */
.weather-card .weather-condition,
.weather-card .weather-meta,
.weather-card .weather-temp,
.weather-card .weather-icon,
.weather-card .forecast-item .f-time,
.weather-card .forecast-item .f-temp,
.weather-card .forecast-item .f-desc {
    color: inherit !important;
}

.weather-card .weather-icon svg {
    color: inherit;
    fill: currentColor
}

.weather-forecast {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    /* keep items in a single horizontal row */
    justify-content: center;
    /* center the row under the main block */
    gap: var(--space-3);
    /* slightly tighter gap between forecast tiles */
    overflow-x: auto;
    padding: var(--space-1) var(--space-4) var(--space-2) var(--space-4);
    /* bring tiles closer to the main block */
}

.forecast-item {
    min-width: 64px;
    background: var(--tile-bg, rgba(255, 255, 255, 0.22));
    border-radius: var(--radius-5);
    padding: var(--space-3) var(--space-3);
    /* slightly reduced padding */
    text-align: center;
    border: 1px solid var(--tile-border, rgba(0, 0, 0, 0.14));
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-3);
    flex: 0 0 auto;
    /* prevent items from stretching to full width */
}

.forecast-item .f-time {
    color: var(--tile-text, #0b0b0b);
    font-size: var(--text-xs)
}

.forecast-item .f-icon svg {
    width: 28px;
    height: 28px
}

.forecast-item .f-temp {
    font-weight: 800;
    color: inherit
}

.weather-effects {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
    padding-top: var(--space-3)
}

.effect-badge {
    /* default stronger badge bg for improved contrast */
    background: var(--badge-bg, rgba(255, 255, 255, 0.28));
    color: var(--badge-color, var(--muted));
    padding: var(--space-5) var(--space-7);
    /* larger padding for readability */
    border-radius: var(--round);
    font-size: var(--text-md);
    /* larger font for emphasis */
    font-weight: 600;
    line-height: 1;
    border: 1px solid rgba(0, 0, 0, 0.10);
}

/* Make the chip button visually lighter in the card */
.weather-card .chip {
    padding: var(--space-3) var(--space-4);
    font-size: var(--text-sm)
}

/* Tall card look */
.weather-card {
    border-radius: var(--radius-7);
    box-shadow: var(--shadow-weather);
    overflow: hidden;
    /* Slightly reduce brightness & saturation so gradients don't feel too intense */
    filter: brightness(0.94) saturate(0.92);
    transition: background 420ms ease, color 300ms ease, filter 300ms ease;
}

/* Use pseudo-element for reliable background gradient behind content */
.weather-card {
    position: relative;
}

.weather-card::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    background: transparent;
    transition: background 420ms ease, opacity 300ms ease;
}

.weather-card>* {
    position: relative;
    z-index: 1
}

/* Condition gradients applied to pseudo-element */
.weather-card.wc-clear::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.14), rgba(0, 0, 0, 0.14)), linear-gradient(180deg, #f6e7c9, #f1d9b0);
}

.weather-card.wc-partly::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.12), rgba(0, 0, 0, 0.12)), linear-gradient(180deg, #f7efdb, #efe3c8);
}

.weather-card.wc-cloudy::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.10), rgba(0, 0, 0, 0.10)), linear-gradient(180deg, #e6edf2, #cfd8de);
}

.weather-card.wc-light_rain::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.12), rgba(0, 0, 0, 0.12)), linear-gradient(180deg, #d7eaf8, #c9e2f6);
}

.weather-card.wc-heavy_rain::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.14), rgba(0, 0, 0, 0.14)), linear-gradient(180deg, #b9d5ee, #98bddf);
}

.weather-card.wc-thunder::before {
    background: linear-gradient(180deg, #2b333c, #162027);
}

.weather-card.wc-fog::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.10), rgba(0, 0, 0, 0.10)), linear-gradient(180deg, #eef3f4, #e3e9ea);
}

.weather-card.wc-snow::before {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0.18)), linear-gradient(180deg, #f0f8ff, #e1eefc);
}

/* Improve legibility with a subtle text shadow on key items */
.weather-card .weather-condition,
.weather-card .weather-temp,
.weather-card .forecast-item .f-time,
.weather-card .forecast-item .f-temp {
    /* Remove the bright highlight so text doesn't appear washed out on light cards */
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.16);
}

/* Card sizing: fit to left column width */
.weather-card {
    width: 100%;
    box-sizing: border-box
}

/* Top meta row */
.weather-meta-row {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    opacity: 0.95
}

/* Compact weather strip at top of page */
.weather-strip {
    width: 100%;
    box-sizing: border-box;
    padding: 8px 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

.weather-strip-inner {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    justify-content: flex-start;
}

.weather-strip .strip-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center
}

.weather-strip .strip-temp {
    font-weight: 700;
    font-size: 16px
}

.weather-strip .strip-effects {
    display: flex;
    gap: 8px;
    margin-left: 12px
}

.weather-strip .effect-badge {
    padding: 8px 10px;
    font-size: 14px;
    font-weight: 600
}

/* allow condition gradients on strip too */
.weather-strip.wc-clear {
    background: linear-gradient(90deg, #fff2df, #ffe6c8);
    color: #06202a
}

.weather-strip.wc-partly {
    background: linear-gradient(90deg, #fff6e6, #fff0dd);
    color: #06202a
}

.weather-strip.wc-cloudy {
    background: linear-gradient(90deg, #e9eef4, #e0e8f0);
    color: #071025
}

.weather-strip.wc-light_rain {
    background: linear-gradient(90deg, #dbeffd, #cfe9ff);
    color: #021328
}

.weather-strip.wc-heavy_rain {
    background: linear-gradient(90deg, #cbdff7, #b7d6f2);
    color: #021328
}

.weather-strip.wc-thunder {
    background: linear-gradient(90deg, #c1c9d3, #aebac6);
    color: #071025
}

.weather-strip.wc-fog {
    background: linear-gradient(90deg, #eef2f3, #e2e7e8);
    color: #071025
}

.weather-strip.wc-snow {
    background: linear-gradient(90deg, #f3f9ff, #e8f3ff);
    color: #06202a
}

/* Tone down strip also */
.weather-strip {
    filter: brightness(0.96) saturate(0.92);
}

/* Icon animations */
.weather-icon svg {
    width: 56px;
    height: 56px;
    display: block
}

.weather-icon {
    transition: transform .35s ease;
}

.weather-rolling .weather-icon {
    transform: rotate(8deg) scale(1.02)
}

/* Forecast styling adjustments for the tall card */
.weather-forecast {
    padding: 8px 0 4px 0
}

.forecast-item {
    min-width: 72px;
    padding: 10px 8px
}

/* Stats row */
.weather-stats {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 4px
}

.stat-chip {
    background: rgba(255, 255, 255, 0.08);
    padding: 6px 8px;
    border-radius: 999px;
    font-size: 12px
}

.star {
    cursor: pointer;
    color: #ffd365
}

/* To-Do UI */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0
}

.todo-form {
    display: flex;
    gap: 8px;
    margin-bottom: 8px
}

/* Todo styles moved to enhanced-todo.css */

/* Modal */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1100;
    display: flex;
    align-items: center;
    justify-content: center
}

/* Wikilink Resolve UI */
.wikiPickRow {
    border: 1px solid var(--border);
    border-radius: var(--radius-4);
    padding: var(--space-3);
    cursor: pointer;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-2);
}

.wikiPickRow.is-selected {
    outline: 2px solid var(--border);
    background: var(--panel);
}

.wikiPickMark {
    font-size: 12px;
    opacity: .85;
}

.wikiSelectedSummary {
    margin-top: 10px;
    font-size: 12px;
    color: var(--muted);
}

.wikiFooter {
    position: sticky;
    bottom: 0;
    margin-top: var(--space-3);
    padding-top: var(--space-2);
    background: var(--bg);
    display: flex;
    justify-content: space-between;
    gap: var(--space-2);
}

.modal-backdrop .modal {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius-6);
    box-shadow: var(--shadow-modal);
    width: min(960px, 90vw);
    height: min(80vh, 720px);
    display: flex;
    flex-direction: column;
    overflow: hidden
}

.modal-backdrop .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-4) var(--space-6);
    border-bottom: 1px solid var(--border)
}

.modal-backdrop .modal-title {
    font-weight: 600
}

.modal-backdrop .modal-close {
    border: 1px solid var(--ui-hairline);
    background: var(--ui-control-bg);
    color: var(--muted);
    border-radius: var(--radius-4);
    padding: var(--space-2) var(--space-4);
    cursor: pointer
}

.modal-backdrop .modal-body {
    flex: 1;
    padding: var(--space-4)
}

.modal-backdrop .modal-graph {
    height: 100%;
    border: 1px solid var(--border);
    border-radius: var(--radius-4);
    background: var(--panel)
}

#sessionEditor {
    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--border)
}

/* Lightbox overlay */
body.lightbox-open {
    overflow: hidden
}

body.lightbox-open .layout {
    filter: blur(4px) grayscale(50%)
}

.lightbox-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 2147483646;
    cursor: zoom-out
}

.lightbox-img {
    position: fixed;
    z-index: 2147483647;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 96vw;
    max-height: 96vh
}

.lightbox-img img {
    display: block;
    max-width: 96vw;
    max-height: 96vh;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: var(--radius-4);
    box-shadow: var(--shadow-img)
}
