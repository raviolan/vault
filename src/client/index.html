<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DM Vault</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 16 16%27%3E%3Ccircle cx=%278%27 cy=%278%27 r=%277%27 fill=%27%238b5cf6%27/%3E%3C/svg%3E" />

  <!-- Core theme/styles (copied from your current build to preserve the look) -->
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="/assets/components.css" />
  <link rel="stylesheet" href="/assets/enhanced-todo.css" />
  <link rel="stylesheet" href="/assets/modal.css" />
  <link rel="stylesheet" href="/assets/landing-pages.css" />

  <!-- Optional per-user overrides (lives in the user's data volume). 404 is fine. -->
  <link rel="stylesheet" href="/user/custom.css" />

  <script>window.SITE_BASE = "/"</script>
</head>
<body>
  <div class="layout">
    <!-- TOP TOOLBAR (global) -->
    <div class="top">
      <div class="toolbar">
        <a class="chip" href="/" data-link>Hembr√§nt</a>
        <a class="chip" href="/tags" data-link>Tags</a>
        <a class="chip" href="/session" data-link>Session</a>
        <button id="btnCreatePage" class="chip" title="Create New Page">+ New</button>
        <button id="btnEditPage" class="chip" title="Edit This Page" disabled>Edit</button>
      </div>
      <div class="search">
        <input id="searchBox" type="search" placeholder="Search titles, headings, #tags (Cmd/Ctrl-K)" />
      </div>
      <div id="themeModeSwitch" style="display:flex; gap:6px; align-items:center;">
        <button id="themeModeDark" class="chip" aria-pressed="true" title="Dark mode">Dark</button>
        <button id="themeModeLight" class="chip" aria-pressed="false" title="Light mode">Light</button>
      </div>
      <div id="searchResults" class="hovercard"></div>
    </div>

    

    <!-- LEFT NAV (global) -->
    <aside class="left">
      <div class="drawer" aria-label="Navigation">
        <div class="drawer-handle">
          <button id="leftDrawerToggle" class="chip" aria-expanded="true" aria-controls="leftDrawer">Nav</button>
          <button id="leftDrawerPin" class="chip" aria-pressed="true">Pin</button>
          <button id="leftCollapseExpand" class="chip" title="Collapse/Expand All">Collapse all</button>
        </div>

        <div id="leftDrawer" class="drawer-content">
          <aside class="sidebar" role="navigation">
            <div class="campaign-header">
              <div class="campaign-title">Feywild Adventures</div>
            </div>

            <nav class="nav">
              <a class="nav-item nav-dashboard" href="/" data-link>
                <span class="nav-icon">üè†</span><span class="nav-text">Dashboard</span>
              </a>

              <div class="nav-quick"><input id="navQuick" placeholder="Quick nav..." /></div>

              <details class="nav-details" open>
                <summary class="nav-label"><span class="nav-icon">‚≠ê</span><span>Favorites</span></summary>
                <ul id="navFav" class="nav-list"></ul>
              </details>

              <ul id="navSections" class="nav-sections"></ul>
            </nav>

            <!-- Weather card placeholder (hook later) -->
            <div id="weatherCard" class="card weather-card" aria-label="Weather" hidden>
              <div class="weather-header">
                <div class="weather-title">Weather</div>
                <button id="rollWeather" class="chip" title="Roll weather">Roll</button>
              </div>
            </div>

            <!-- Bottom-left mini app mount (Settings lives here) -->
            <div id="leftPanelBottomApp" class="card" style="margin-top: 10px;"></div>
          </aside>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT OUTLET (dynamic) -->
    <main class="main">
      <div class="breadcrumb-container">
        <div id="breadcrumbText" class="main-breadcrumb meta"></div>
        <button id="btnDeletePage" class="delete-page-btn" title="Delete this page" aria-label="Delete this page" hidden>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />
          </svg>
        </button>
      </div>

      <div id="outlet"></div>
    </main>

    <!-- RIGHT PANEL (global; placeholder for now) -->
    <aside class="right">
      <div class="right-drawer" aria-label="Side panel">
        <div class="right-drawer-handle">
          <button id="rightDrawerToggle" class="chip" aria-expanded="false">Tools</button>
          <button id="rightDrawerPin" class="chip" aria-pressed="false">Pin</button>
        </div>

        <div id="rightDrawer" class="right-drawer-content" hidden>
          <div class="right-panel-tabs">
            <button class="chip" data-tab="notepad">Notepad</button>
            <button class="chip" data-tab="colors">Colors</button>
            <button class="chip" data-tab="todo">To-Do</button>
            <button class="chip" data-tab="backlinks">Backlinks</button>
            <button class="chip" data-tab="settings">Settings</button>
          </div>

          <section class="right-panel" data-panel="notepad">
            <h3 class="meta">Notepad</h3>
            <textarea id="notepad" placeholder="Notes live in your local vault..."></textarea>
          </section>

          <section class="right-panel" data-panel="colors" hidden>
            <h3 class="meta">Colors</h3>
            <p class="meta">(wired up later)</p>
          </section>

          <section class="right-panel" data-panel="todo" hidden>
            <h3 class="meta">To-Do</h3>
            <div class="todo-row">
              <input id="todoInput" placeholder="Add a task" />
              <button id="todoAdd" class="chip">Add</button>
            </div>
            <ul id="todoList"></ul>
          </section>

          <section class="right-panel" data-panel="backlinks" hidden>
            <h3 class="meta">Backlinks</h3>
            <ul id="backlinksList"></ul>
            <p id="backlinksEmpty" class="meta" hidden>No backlinks yet</p>
          </section>

          <section class="right-panel" data-panel="settings" hidden>
            <h3 class="meta">Settings</h3>
            <div id="settingsPanel"></div>
          </section>
        </div>
      </div>
    </aside>

    <!-- FOOTER (global) -->
    <footer class="footer">
      <div class="meta">¬© <span id="year"></span> Feywild Adventures</div>
    </footer>
  </div>

  <!-- Modals (global) -->
  <div class="modal" id="createPageModal" tabindex="-1" aria-modal="true" style="display:none;">
    <div class="modal-content">
      <h2>Create New Page</h2>
      <form>
        <label>Type
          <select name="pageType">
            <option value="note">Note</option>
            <option value="npc">NPC</option>
            <option value="location">Location</option>
            <option value="arc">Arc</option>
            <option value="tool">Tool</option>
          </select>
        </label>
        <label>Title
          <input name="pageTitle" type="text" required autocomplete="off" />
        </label>
        <div class="modal-actions">
          <button type="button" class="modal-cancel">Cancel</button>
          <button type="button" class="modal-confirm">Create</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="deletePageModal" tabindex="-1" aria-modal="true" style="display:none;">
    <div class="modal-content">
      <h2>Delete Page</h2>
      <p>Are you sure? This cannot be undone.</p>
      <p>Type the page title to confirm: <strong class="delete-page-title-label"></strong></p>
      <input name="deleteConfirmTitle" type="text" autocomplete="off" />
      <div class="modal-actions">
        <button type="button" class="modal-cancel">Cancel</button>
        <button type="button" class="modal-confirm" disabled>Delete</button>
      </div>
    </div>
  </div>

  <script type="module" src="/app.js"></script>
</body>
</html>
